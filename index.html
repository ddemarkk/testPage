<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
  <title>React App</title>
</head>

<body>
  <div id="root"></div>
  <script>
  "use strict";
  window.addEventListener(
    "load",
    function () {
      var script = document.createElement("script");
      loadWidget();
      function getCookie(name) {
        var matches = document.cookie.match(new RegExp(
          "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
        ));
        return matches ? decodeURIComponent(matches[1]) : undefined;
      };
      function loadWidget() {
        script.src = "https://app.activechat.ai/gateway/script/1235315b-2752-4109-b99d-21b1d0bcb4b0";
        script.id = "ACCW_EMBED";
        document.getElementsByTagName("head")[0].appendChild(script);
      };
      if(!getCookie('sessionHistory')) document.cookie = 'sessionHistory=bot;';
      window.addEventListener('message', function (event) {
          if (event.data === 'open') activechat.track('widget_open');
          else if (event.data === 'close') activechat.track('widget_close');
           if (String(event.data).includes('user') || String(event.data).includes('agent') || String(event.data).includes('bot')) {
              console.log(document.domain)
              activechat.track('session_types', { domain_url: document.domain })
              if(getCookie('sessionHistory') && (getCookie('sessionHistory').split(',').length < event.data.split(',').length || getCookie('sessionHistory') === 'bot')) {
                console.log(event.data)
                document.cookie = 'sessionHistory=' + event.data;
                setTimeout(function() {
                  activechat.track('session_types', { session_type: event.data });
                }, 2000)
              } 
            }
        });
      var now = new Date();
      var time = now.getTime();
      time += 10800 * 1000;
      now.setTime(time);
      function guid() { return s4() + s4() + s4() + s4() + s4() + s4() + s4() + s4(); }
      function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
          .toString(16)
          .substring(4)
      }
      setTimeout("location.reload(true);",10805 * 1000);
      var userActive = getCookie('userActive');
      if (!userActive) {
        document.cookie =
          'userActive=' + true +
          '; expires=' + now.toUTCString() +
          '; path=/';
        document.cookie = 'userID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
        document.cookie = 'anonymousID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
        document.cookie = 'ActiveChat_anonymousID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
        setTimeout(function() {
          loadWidget();
        }, 2000);
      } else {
        document.cookie =
          'userActive=' + true +
          '; expires=' + now.toUTCString() +
          '; path=/'
      }
      var accessToken = localStorage.getItem('accessToken');
      var idToken = sessionStorage.getItem('idToken');
      var userLogin = window.user_login;
      var userEmail = window.user_email;
      var userId = window.user_id;
      var customerNumber = window.actual_customer_no;
      window.acTrackingLoaded = function () {
        activechat.track('Authorized', {
          userLogin: userLogin,
          userEmail: userEmail,
          _email: userEmail,
          userId: userId,
          customerNumber: customerNumber,
        });
        if (accessToken && idToken) {
          activechat.track('Authorized', {
            accessToken: accessToken,
            idToken: idToken,
          });
        };
      };
    },
    false
  );
</script>
  
</body>

</html>
