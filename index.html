<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
  <title>React App</title>
</head>

<body>
  <div id="root"></div>
  <script>
  "use strict";
  window.addEventListener(
    "load",
    function () {
      var script = document.createElement("script");
      script.src = "https://dev.activechat.ai/gateway/script/5b440966-f0f4-4d94-8785-6a0a7d8e9eb9";
      script.id = "ACCW_EMBED";
      document.getElementsByTagName("head")[0].appendChild(script);
      function randomString() {
        return Math['floor']((0x1 + Math['random']()) * 0x10000000000000)['toString'](0x10);
      }
      var part1 = randomString();
      var part2 = randomString();
      function guid() { return s4() + s4() + s4() + s4() + s4() + s4() + s4() + s4(); }
      function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
          .toString(16)
          .substring(4)
      }
      setTimeout(function () {
        location.reload()
      }, 10805 * 1000)
      var now = new Date();
      var time = now.getTime();
      time += 10800 * 1000;
      now.setTime(time);
      function getCookie(name) {
        return document.cookie.split(';').filter(function (element) {
        if(element.split('=')[0].trim() === name) return element.split('=')[1].trim()
      })
      }
      var userActive = getCookie('userActive');
      var sessionType = getCookie('sessionType')
      console.log(userActive, sessionType)
      if (!userActive.length) {
        document.cookie =
          'userActive=' + true +
          '; expires=' + now.toUTCString() +
          '; path=/';
        document.cookie = 'userID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
        document.cookie = 'anonymousID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
        document.cookie = 'ActiveChat_anonymousID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
        document.cookie = 'anonymousID=' + part1 + part2;
        document.cookie = 'ActiveChat_anonymousID=' + part1 + part2;
        activechat.track('_page_visit');
      } else {
        document.cookie =
          'userActive=' + true +
          '; expires=' + now.toUTCString() +
          '; path=/'
      }
      var sessionType = ['bot'];
      var accessToken = localStorage.getItem('accessToken');
      var idToken = sessionStorage.getItem('idToken');
      var userLogin = window.user_login;
      var userEmail = window.user_email;
      var userId = window.user_id;
      var customerNumber = window.actual_customer_no;
      window.acTrackingLoaded = function () {
        window.addEventListener('message', function (event) {
          if (event.data === 'open') activechat.track('widget_open');
          else if (event.data === 'close') activechat.track('widget_close');
          if (event.data === 'user' || event.data === 'agent' || event.data === 'bot') {
              console.log(event.data)
              if (!sessionType.includes(String(event.data)) && sessionType.length < 3) sessionType.push(event.data)
              console.log(sessionType)
            }
        });
        activechat.track('Authorized', {
          userLogin: userLogin,
          userEmail: userEmail,
          _email: userEmail,
          userId: userId,
          customerNumber: customerNumber,
        });
        if (accessToken && idToken) {
          activechat.track('Authorized', {
            accessToken: accessToken,
            idToken: idToken,
          });
        };
      };
    },
    false
  );
</script>
  
</body>

</html>
